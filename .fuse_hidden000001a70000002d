import markdown
from flask import Flask
from flask import render_template
from flask import Markup

import itertools
import yaml
import glob
import string
import os

application = Flask(__name__)
#application.debug=True

@application.route('/')
def index():
    return 'Hello world!  Er, no... wait, yes!'

@application.route('/bio/')
def bio_index():
    return 'all about me'

@application.route('/blog/')
def blog_index():
    current_dir = './blog'
    dirs = [name for name in os.listdir('.')]# if os.path.isdir(name)] #os.path.join(current_dir, name))]
    return dirs.__str__()
    files = glob.glob('blog/*.md')
    blog_files = [parse_post_file(file) for file in files]
    blog_files[0]['body'] = Markup(markdown.markdown(blog_files[0]['body']))
    return render_template('index.html', post=blog_files[0])
    return 'lots of blogs, so many blogs.'

@application.route('/research/')
def research_index():
    return 'lots of projects, so many projects.'

def parse_post_file(filename):
    file = open(filename)
    lines = file.readlines()
    file.close()

    post = {}

    # Read lines until an empty line is encountered, then build a dictionary with yaml
    # code jacked from flask-flatpages
    lines = iter(lines)
    meta = u'\n'.join(itertools.takewhile(string.strip, lines))
    post = yaml.safe_load(meta)

    # The rest is the content. `lines` is an iterator so it continues
    # where `itertools.takewhile` left it.
    post['body'] = u'\n'.join(lines)

    return post

if __name__ == '__main__':
    application.run()
